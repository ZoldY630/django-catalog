{% extends "base.html" %}
{% block content %}
<h1>Корзина</h1>
{% if cart %}
<table class="table">
    {% for item in cart %}
    <tr>
        <td><img src="{{ item.product.image.url }}" width="80"></td>
        <td>{{ item.product.name }}</td>
        <td>{{ item.quantity }} × {{ item.price }} ₽</td>
        <td><strong>{{ item.total_price }} ₽</strong></td>
        <td>
            <form action="{% url 'cart:cart_remove' item.product.id %}" method="post">
                {% csrf_token %}
                <button class="btn btn-danger btn-sm">Удалить</button>
            </form>
        </td>
    </tr>
    {% endfor %}
    <tr class="table-success">
        <td colspan="3"><strong>Итого:</strong></td>
        <td><strong>{{ cart.get_total_price }} ₽</strong></td>
    </tr>
    {% if cart.coupon %}
    <tr class="table-info">
        <td colspan="3">Скидка по промокоду "{{ cart.coupon.code }}"</td>
        <td>-{{ cart.get_discount }} ₽</td>
    </tr>
    {% endif %}
    <tr class="table-warning">
        <td colspan="3"><strong>К оплате:</strong></td>
        <td><strong>{{ cart.get_total_after_discount }} ₽</strong></td>
    </tr>
</table>

<form action="{% url 'coupon_apply' %}" method="post" class="mb-4">
    {% csrf_token %}
    <input type="text" name="code" placeholder="Введите промокод" class="form-control d-inline w-50">
    <button type="submit" class="btn btn-success">Применить</button>
</form>

<a href="{% url 'order_create' %}" class="btn btn-primary btn-lg">Оформить заказ</a>
{% else %}
<p>Корзина пуста</p>
{% endif %}
{% endblock %}